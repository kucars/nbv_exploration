<?xml version="1.0" ?>
<launch>
    <!-- World types are mutually exclusive. Only set ONE of them to "1" -->
    <arg name="world_type_debug_box" default="0"/>
    <arg name="world_type_full_size" default="0"/>
    <arg name="world_type_half_size" default="1"/>

    <!-- Vehicle settings -->
    <arg name="use_floating_sensor" default="true"/>
    <arg name="floating_sensor_model" value="$(find nbv_exploration)/urdf/floating_sensor.gazebo"/>

    <arg name="rtab_ns" default="rtabmap"/>
    <env name="GAZEBO_MODEL_PATH" value="$(find rotors_gazebo)/models"/>
    <arg name="vehicle" default="robot"/>

    

    <!-- Starting position UAV1-->
    <!-- Debug box UAV start location -->
    <arg name="vehicle_starting_x1" value="0"      if="$(arg world_type_debug_box)"/>
    <arg name="vehicle_starting_y1" value="-20"    if="$(arg world_type_debug_box)"/>
    <arg name="vehicle_starting_z1" value="0.5"    if="$(arg world_type_debug_box)"/>
    <arg name="vehicle_starting_Y1" value="1.5707" if="$(arg world_type_debug_box)"/>

    <!-- Full sized scenario spawn point -->
    <arg name="vehicle_starting_x1" value="0"      if="$(arg world_type_full_size)"/>
    <arg name="vehicle_starting_y1" value="-38"    if="$(arg world_type_full_size)"/>
    <arg name="vehicle_starting_z1" value="0.5"    if="$(arg world_type_full_size)"/>
    <arg name="vehicle_starting_Y1" value="1.5707" if="$(arg world_type_full_size)"/>

    <!-- Half sized scenario spawn point -->
    <arg name="vehicle_starting_x1" value="4"    if="$(arg world_type_half_size)"/>
    <arg name="vehicle_starting_y1" value="-5"   if="$(arg world_type_half_size)"/>
    <arg name="vehicle_starting_z1" value="3"    if="$(arg world_type_half_size)"/>
    <arg name="vehicle_starting_Y1" value="3.14" if="$(arg world_type_half_size)"/>

    <!-- Starting position UAV2-->
    <!-- Debug box UAV start location -->
    <arg name="vehicle_starting_x2" value="0"      if="$(arg world_type_debug_box)"/>
    <arg name="vehicle_starting_y2" value="-20"    if="$(arg world_type_debug_box)"/>
    <arg name="vehicle_starting_z2" value="2.5"    if="$(arg world_type_debug_box)"/>
    <arg name="vehicle_starting_Y2" value="1.5707" if="$(arg world_type_debug_box)"/>

    <!-- Full sized scenario spawn point -->
    <arg name="vehicle_starting_x2" value="0"      if="$(arg world_type_full_size)"/>
    <arg name="vehicle_starting_y2" value="-38"    if="$(arg world_type_full_size)"/>
    <arg name="vehicle_starting_z2" value="2.5"    if="$(arg world_type_full_size)"/>
    <arg name="vehicle_starting_Y2" value="1.5707" if="$(arg world_type_full_size)"/>

    <!-- Half sized scenario spawn point -->
    <arg name="vehicle_starting_x2" value="4"    if="$(arg world_type_half_size)"/>
    <arg name="vehicle_starting_y2" value="-5"   if="$(arg world_type_half_size)"/>
    <arg name="vehicle_starting_z2" value="5"    if="$(arg world_type_half_size)"/>
    <arg name="vehicle_starting_Y2" value="3.14" if="$(arg world_type_half_size)"/>

    
    

    <!-- Misc settings -->
    <arg name="enable_rtab"  default="false"/>
    <arg name="start_gazebo" default="true"/>
    
    <arg name="scan_topic" default="/nbv_exploration/scan"/>
    <arg name="depth_topic" default="/nbv_exploration/depth"/>
    <arg name="depth2_topic" default="/nbv_exploration/depth2"/>
    
    <!-- Start Gazebo and set up the world -->
    <include if="$(arg start_gazebo)" file="$(find gazebo_ros)/launch/empty_world.launch">
      <arg name="debug" value="false" />
      <arg name="headless" value="false"/>
      <arg name="gui" value="true"/>

      <!-- debug box -->
      <arg name="world_name"
        if="$(arg world_type_debug_box)"
        value="$(find nbv_exploration)/worlds/box.world"
      />

      <!-- full size -->
      <arg name="world_name"
        if="$(arg world_type_full_size)"
        value="$(find nbv_exploration)/worlds/etihad_aircraft_world.world"
      />

      <!-- half size -->
      <arg name="world_name"
        if="$(arg world_type_half_size)"
        value="$(find nbv_exploration)/worlds/etihad_aircraft_world_half.world"
      />
    </include>

    
    <!-- Start RVIZ -->
    <node pkg="rviz" name="rviz" type="rviz" args="-d $(find nbv_exploration)/config/multi_nbv_rtabmap.rviz" required="false" />

    
    
    
    

    <!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> Robot 1 nodes instances <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->    
    <group ns="robot_1">
        
    <!-- Spawn vehicle -->
    <include if="$(arg use_floating_sensor)" file="$(find nbv_exploration)/launch/spawn_vehicle_floating_sensor.launch">
      <arg name="vehicle_starting_x" value="$(arg vehicle_starting_x1)"/>
      <arg name="vehicle_starting_y" value="$(arg vehicle_starting_y1)"/>
      <arg name="vehicle_starting_z" value="$(arg vehicle_starting_z1)"/>
      <arg name="vehicle_starting_Y" value="$(arg vehicle_starting_Y1)"/>
      <arg name="name" value="$(arg vehicle)_1" />
      <arg name="tf_prefix" value="$(arg vehicle)_1"/>
    </include>

    <include unless="$(arg use_floating_sensor)" file="$(find nbv_exploration)/launch/spawn_vehicle_uav.launch">
      <arg name="vehicle_starting_x" value="$(arg vehicle_starting_x1)"/>
      <arg name="vehicle_starting_y" value="$(arg vehicle_starting_y1)"/>
      <arg name="vehicle_starting_z" value="$(arg vehicle_starting_z1)"/>
      <arg name="vehicle_starting_Y" value="$(arg vehicle_starting_Y1)"/>
      <arg name="name" value="$(arg vehicle)_1" />
      <arg name="tf_prefix" value="$(arg vehicle)_1"/>
    </include>
    

     
    <!-- Set up RTAB -->
<!--    <group ns="$(arg rtab_ns)" if="$(arg enable_rtab)">
      <node pkg="rtabmap_ros" name="rtabmap" type="rtabmap" output="screen" args="delete_db_on_start">
	<param name="frame_id" type="string" value="/iris/xtion_sensor/ground_truth/iris/xtion_sensor/ground_truth/odometry_sensor_link"/>
	<param name="map_frame_id" type="string" value="map"/>
	<param name="subscribe_depth"     type="bool" value="true"/>
	<param name="subscribe_odom_info" type="bool" value="true"/>
	<param name="subscribe_laserScan" type="bool" value="true"/>
	<param name="wait_for_transform" type="bool" value="true"/>

	<remap from="odom"            to="/iris/ground_truth/odometry"/>
	<remap from="depth/image"     to="/iris/xtion_sensor/iris/xtion_sensor_camera/depth/image_raw"/>
	<remap from="rgb/image"       to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/image_raw"/>
	<remap from="rgb/camera_info" to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/camera_info"/>
	<remap from="scan"            to="$(arg scan_topic)"/>

        <param name="queue_size" type="int" value="10"/>

        <param name="RGBD/NeighborLinkRefining" type="string" value="false"/>  
	<param name="RGBD/ProximityBySpace"     type="string" value="true"/> 
	<param name="RGBD/ProximityByTime"      type="string" value="false"/> 
	<param name="RGBD/OptimizeFromGraphEnd" type="string" value="true"/>
	<param name="Reg/Strategy"              type="string" value="1"/>     
	<param name="Vis/InlierDistance"        type="string" value="0.01"/>   
	<param name="RGBD/OptimizeFromGraphEnd" type="string" value="false"/> 
	<param name="Optimizer/Slam2D"          type="string" value="false"/>
	<param name="Reg/Force3DoF"             type="string" value="false"/>
	<param name="Rtabmap/DetectionRate"     type="string" value="10"/>    
	
	<param name="Icp/MaxCorrespondenceDistance" type="string" value="0.05"/> 
	<param name="Icp/MaxRotation"               type="string" value="0.78"/> 
	<param name="Icp/MaxTranslation"            type="string" value="0.20"/> 
      </node>-->
    
      <!-- Visualisation RTAB-Map -->
      <!--
      <node pkg="rtabmap_ros" type="rtabmapviz" name="rtabmapviz"  output="screen">
	  <param name="subscribe_depth"     type="bool"   value="true"/>
	  <param name="subscribe_laserScan" type="bool"   value="true"/>
	  <param name="subscribe_odom_info" type="bool"   value="true"/>
	  <param name="frame_id"            type="string" value="world"/>

	  <remap from="odom" to="/iris/xtion_sensor/ground_truth/odometry"/>
	  <remap from="depth/image" to="/iris/xtion_sensor/iris/xtion_sensor_camera/depth/image_raw"/>
	  <remap from="rgb/image" to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/image_raw"/>
	  <remap from="rgb/camera_info" to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/camera_info"/>
      </node>
      -->
<!--     </group> -->
    
    
    <!-- Run nodes -->    
    <!-- correct the laser scan points near the max and min range -->
    <node if="$(arg use_floating_sensor)" pkg="nbv_exploration" name="correct_laser_scan_and_depth" type="correct_laser_scan_and_depth" args="" required="true" output="screen">
      <rosparam file="$(find nbv_exploration)/config/sensor_settings.yaml" command="load" />
	  <remap from="scan_in"    to="/robot_1/scan"/>
	  <remap from="scan_out"   to="/robot_1/$(arg scan_topic)"/>
	  <remap from="depth_in"   to="/robot_1/camera/depth/points"/>
	  <remap from="depth_out"  to="/robot_1/$(arg depth_topic)"/>
	  <remap from="depth2_in"  to="/robot_1/camera2/depth/points"/>
	  <remap from="depth2_out" to="/robot_1/$(arg depth2_topic)"/>
    </node>

    <node unless="$(arg use_floating_sensor)" pkg="nbv_exploration" name="correct_laser_scan_and_depth" type="correct_laser_scan_and_depth" args="" required="true" output="screen">
      <rosparam file="$(find nbv_exploration)/config/sensor_settings.yaml" command="load" />     
	  <remap from="scan_in"    to="/robot_1/iris/scan"/>
	  <remap from="scan_out"   to="/robot_1/$(arg scan_topic)"/>
	  <remap from="depth_in"   to="/robot_1/iris/xtion_sensor/iris/xtion_sensor_camera/depth/points"/>
	  <remap from="depth_out"  to="/robot_1/$(arg depth_topic)"/>
	  <remap from="depth2_in"  to="/robot_1/iris/xtion_sensor/iris/xtion_sensor_camera2/depth/points"/>
	  <remap from="depth2_out" to="/robot_1/$(arg depth2_topic)"/>
    </node>
    
    </group>
    
    
    <!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> Robot 2 nodes instances <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->    
   <group ns="robot_2">
        
    <!-- Spawn vehicle -->
    <include if="$(arg use_floating_sensor)" file="$(find nbv_exploration)/launch/spawn_vehicle_floating_sensor.launch">
      <arg name="vehicle_starting_x" value="$(arg vehicle_starting_x2)"/>
      <arg name="vehicle_starting_y" value="$(arg vehicle_starting_y2)"/>
      <arg name="vehicle_starting_z" value="$(arg vehicle_starting_z2)"/>
      <arg name="vehicle_starting_Y" value="$(arg vehicle_starting_Y2)"/>
      <arg name="name" value="$(arg vehicle)_2" />
      <arg name="tf_prefix" value="$(arg vehicle)_2"/>
    </include>

    <include unless="$(arg use_floating_sensor)" file="$(find nbv_exploration)/launch/spawn_vehicle_uav.launch">
      <arg name="vehicle_starting_x" value="$(arg vehicle_starting_x2)"/>
      <arg name="vehicle_starting_y" value="$(arg vehicle_starting_y2)"/>
      <arg name="vehicle_starting_z" value="$(arg vehicle_starting_z2)"/>
      <arg name="vehicle_starting_Y" value="$(arg vehicle_starting_Y2)"/>
      <arg name="name" value="$(arg vehicle)_2" />   
      <arg name="tf_prefix" value="$(arg vehicle)_2"/>
    </include>
    

     
    <!-- Set up RTAB -->
<!--    <group ns="$(arg rtab_ns)" if="$(arg enable_rtab)">
      <node pkg="rtabmap_ros" name="rtabmap" type="rtabmap" output="screen" args="delete_db_on_start">
	<param name="frame_id" type="string" value="/iris/xtion_sensor/ground_truth/iris/xtion_sensor/ground_truth/odometry_sensor_link"/>
	<param name="map_frame_id" type="string" value="map"/>
	<param name="subscribe_depth"     type="bool" value="true"/>
	<param name="subscribe_odom_info" type="bool" value="true"/>
	<param name="subscribe_laserScan" type="bool" value="true"/>
	<param name="wait_for_transform" type="bool" value="true"/>

	<remap from="odom"            to="/iris/ground_truth/odometry"/>
	<remap from="depth/image"     to="/iris/xtion_sensor/iris/xtion_sensor_camera/depth/image_raw"/>
	<remap from="rgb/image"       to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/image_raw"/>
	<remap from="rgb/camera_info" to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/camera_info"/>
	<remap from="scan"            to="$(arg scan_topic)"/>

        <param name="queue_size" type="int" value="10"/>

        <param name="RGBD/NeighborLinkRefining" type="string" value="false"/>  
	<param name="RGBD/ProximityBySpace"     type="string" value="true"/> 
	<param name="RGBD/ProximityByTime"      type="string" value="false"/> 
	<param name="RGBD/OptimizeFromGraphEnd" type="string" value="true"/>
	<param name="Reg/Strategy"              type="string" value="1"/>     
	<param name="Vis/InlierDistance"        type="string" value="0.01"/>   
	<param name="RGBD/OptimizeFromGraphEnd" type="string" value="false"/> 
	<param name="Optimizer/Slam2D"          type="string" value="false"/>
	<param name="Reg/Force3DoF"             type="string" value="false"/>
	<param name="Rtabmap/DetectionRate"     type="string" value="10"/>    
	
	<param name="Icp/MaxCorrespondenceDistance" type="string" value="0.05"/> 
	<param name="Icp/MaxRotation"               type="string" value="0.78"/> 
	<param name="Icp/MaxTranslation"            type="string" value="0.20"/> 
      </node>-->
    
      <!-- Visualisation RTAB-Map -->
      <!--
      <node pkg="rtabmap_ros" type="rtabmapviz" name="rtabmapviz"  output="screen">
	  <param name="subscribe_depth"     type="bool"   value="true"/>
	  <param name="subscribe_laserScan" type="bool"   value="true"/>
	  <param name="subscribe_odom_info" type="bool"   value="true"/>
	  <param name="frame_id"            type="string" value="world"/>

	  <remap from="odom" to="/iris/xtion_sensor/ground_truth/odometry"/>
	  <remap from="depth/image" to="/iris/xtion_sensor/iris/xtion_sensor_camera/depth/image_raw"/>
	  <remap from="rgb/image" to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/image_raw"/>
	  <remap from="rgb/camera_info" to="/iris/xtion_sensor/iris/xtion_sensor_camera/rgb/camera_info"/>
      </node>
      -->
<!--     </group> -->
    
    
    <!-- Run nodes -->    
    <!-- correct the laser scan points near the max and min range -->
    <node if="$(arg use_floating_sensor)" pkg="nbv_exploration" name="correct_laser_scan_and_depth" type="correct_laser_scan_and_depth" args="" required="true" output="screen">
      <rosparam file="$(find nbv_exploration)/config/sensor_settings.yaml" command="load" />
	  <remap from="scan_in"    to="/robot_2/scan"/>
	  <remap from="scan_out"   to="/robot_2/$(arg scan_topic)"/>
	  <remap from="depth_in"   to="/robot_2/camera/depth/points"/>
	  <remap from="depth_out"  to="/robot_2/$(arg depth_topic)"/>
	  <remap from="depth2_in"  to="/robot_2/camera2/depth/points"/>
	  <remap from="depth2_out" to="/robot_2/$(arg depth2_topic)"/>
    </node>

    <node unless="$(arg use_floating_sensor)" pkg="nbv_exploration" name="correct_laser_scan_and_depth" type="correct_laser_scan_and_depth" args="" required="true" output="screen">
      <rosparam file="$(find nbv_exploration)/config/sensor_settings.yaml" command="load" />     
	  <remap from="scan_in"    to="/robot_2/iris/scan"/>
	  <remap from="scan_out"   to="/robot_2/$(arg scan_topic)"/>
	  <remap from="depth_in"   to="/robot_2/iris/xtion_sensor/iris/xtion_sensor_camera/depth/points"/>
	  <remap from="depth_out"  to="/robot_2/$(arg depth_topic)"/>
	  <remap from="depth2_in"  to="/robot_2/iris/xtion_sensor/iris/xtion_sensor_camera2/depth/points"/>
	  <remap from="depth2_out" to="/robot_2/$(arg depth2_topic)"/>
    </node>
    
    </group>    
    
    
</launch>
